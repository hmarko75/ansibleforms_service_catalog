categories:
  - name: Default
    icon: bars
  - name: Provision
    icon: bath
  - name: Maintenance
    icon: bath
roles:
  - name: admin
    groups:
      - local/admins
      - ldap/Domain Admins
  - name: operator
    groups:
      - local/operator
  - name: demo
    groups:
      - local/demo
  - name: public
    groups: []
  - name: Provision
    groups:
      - local/Provision Admins
forms:
  - name: Cleanup Ansibleforms Jobs
    showHelp: true
    help: |
      This form starts the `ansibleforms_job_cleanup.yaml` playbook
      It will remove all ansible job logs
    roles:
      - admin
    description: This will cleanup all ansible job logs.
    icon: trash
    categories:
      - Maintenance
    tileClass: has-background-danger-light
    playbook: ansibleforms_job_cleanup.yaml
    type: ansible
    fields:
      - type: expression
        name: mysql_credential
        expression: "'__self__'"
        label: Credential to connect to database
        asCredential: true
        required: true
        hide: true
      - type: checkbox
        name: areyousure
        label: Confirmation
        default: false
        placeholder: Are you sure you want to cleanup
      - type: text
        name: confirmation
        label: Please type YES to confirm you want to cleanup
        placeholder: YES
        required: true
        regex:
          expression: ^YES$
          description: Type YES to confirm
        dependencies:
          - name: areyousure
            values:
              - true
  - name: Debug
    help: Debug
    roles:
      - Provision
    description: Debug
    categories:
      - Provision
    icon: scroll
    playbook: debug.yaml
    inventory: hosts
    type: ansible
    fields:
      - type: expression
        name: settings
        label: settings
        expression: fn.fnReadYamlFile('/app/dist/persistent/globals.yaml','')
        noOutput: true
        hide: true
      - type: expression
        name: aiqum
        label: aiqum
        expression: fn.fnJq($(settings),'.general.aiqum')
        hide: true
      - type: expression
        name: aiqumlogin
        label: aiqumlogin
        expression: "'AIQUM'"
        asCredential: true
        hide: true
      - type: expression
        name: clusters_info
        label: clusters_info
        expression: fn.fnRestBasic('get','https://'+'$(aiqum)'+'/api/admin/datasources/clusters','','AIQUM','[.records[]|{name:.name}+{key:.key}]','','')
        hide: false
      - type: expression
        name: cluster
        label: cluster
        expression: "'cluster2'"
        hide: false
      - type: expression
        name: cluster_key
        label: cluster_key
        expression: fn.fnJq($(clusters_info),'.[]|select(.name=="$(cluster)")|.key')
        hide: false
